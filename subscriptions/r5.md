# How to use Cerner's Test Server for R5 Subscriptions

Base server URL:  
https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/

Subscription resource:  
https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription

Make sure to request json format for show/search using either:
* ?_format=json
* Accept: application/fhir+json

## Show

GET https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/<id\>

Example:
* https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/1

## Search

GET https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?<query_parameter\>=<value\>&<query_parameter\>=<value\>...

Parameters:
* contact
  * https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?contact=ext%204123
* _id (multiple values comma separated)
  * https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?_id=1,2
* payload
  * https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?payload=application%2Ffhir%2Bjson
* status (multiple values comma separated)
  * https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?status=requested
* type (multiple values comma separated)
  * https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?type=rest-hook
* url
  * https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?url=https%3A%2F%2Fbiliwatch.com%2Fcustomers%2Fmount-auburn-miu%2Fon-result

## Create

POST https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription  
Content-Type: application/fhir+json

Example Body:
```json
{
  "resourceType": "Subscription",
  "status": "requested",
  "topic": {
    "reference": "SubscriptionTopic/admission"
  },
  "contact": [
    {
      "system": "phone",
      "value": "ext 4123",
      "use": "work"
    }
  ],
  "end": "2020-05-13T16:18:29.426Z",
  "reason": "Monitor Patient Admissions for specific patient",
  "filterBy": [
    {
      "searchParamName": "patient",
      "searchModifier": "=",
      "value": "Patient/1316024"
    }
  ],
  "channelType": {
    "code": "rest-hook",
    "display": "Rest Hook",
    "system": "http://terminology.hl7.org/CodeSystem/subscription-channel-type"
  },
  "endpoint": "https://addmission-tracker-example.com/on-admission",
  "header": [
    "Authorization: Bearer some-secret-token"
   ],
  "heartbeatPeriod": 60,
  "contentType": "application/fhir+json",
  "content": "id-only"
}
```

## Update

PUT https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/<id\>  
Content-Type: application/fhir+json  
If-Match: W/"<version_id\>"

Determine If-Match version by reading the Subscription and examining meta.versionId

Example Body (update status from requested to active):
```json
{
  "resourceType": "Subscription",
  "status": "active",
  "topic": {
    "reference": "SubscriptionTopic/admission"
  },
  "contact": [
    {
      "system": "phone",
      "value": "ext 4123",
      "use": "work"
    }
  ],
  "end": "2020-05-13T16:18:29.426Z",
  "reason": "Monitor Patient Admissions for specific patient",
  "filterBy": [
    {
      "searchParamName": "patient",
      "searchModifier": "=",
      "value": "Patient/1316024"
    }
  ],
  "channelType": {
    "code": "rest-hook",
    "display": "Rest Hook",
    "system": "http://terminology.hl7.org/CodeSystem/subscription-channel-type"
  },
  "endpoint": "https://addmission-tracker-example.com/on-admission",
  "header": [
    "Authorization: Bearer some-secret-token"
   ],
  "heartbeatPeriod": 60,
  "contentType": "application/fhir+json",
  "content": "id-only"
}
```

## Triggering Notifications

See [notifications](notifications.md) documentation.

## Example Subscription Data

[example_subscriptions.txt](example_subscriptions.txt)
